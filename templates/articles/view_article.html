{% extends "base.html" %}

{% block title %}{{ article.title }} ‚Äî –õ–∏—Ü–µ–π—Å–∫–∏–π –ø–æ—Ä—Ç–∞–ª{% endblock %}

{% block content %}
<div class="container mt-1 p-0" style="max-width: 1096px;">
  <div class="card mt-2 bg-secondary text-light rounded-0">
    <div class="card-body">
      <h3 class="card-title">{{ article.title }}</h3>

      {% if article.subtitle %}
        <h5 class="card-subtitle mb-3 text-light">{{ article.subtitle }}</h5>
      {% endif %}

      {% if article.featured_image_url %}
        <img src="{{ article.featured_image_url }}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—å–∏" class="img-fluid mb-3 rounded"
             style="max-height: 400px; width: 100%; object-fit: cover;">
      {% endif %}

      {% if article.tags %}
        <p class="text-secondary">{{ article.tags }}</p>
      {% endif %}

      <div class="mt-4 mb-4">{{ article.content_html | safe }}</div>
      <hr class="bg-light">

      <p><strong>–ê–≤—Ç–æ—Ä:</strong> {{ article.author.username }}</p>
      <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> {{ article.category.title }}</p>

      {% if current_user.is_authenticated %}
      <form action="{{ url_for('article.vote_article', article_id=article.id) }}" method="post" class="d-inline">
        <input type="hidden" name="vote_type" value="upvote">
        <button class="btn btn-sm btn-outline-light
        {% if article.get_user_vote(current_user.id) == 1 %}active{% endif %}" type="submit">üëç</button>
      </form>
      <form action="{{ url_for('article.vote_article', article_id=article.id) }}" method="post" class="d-inline"></form>
        {% endif %}
      <span class="mx-2 text-{% if article.vote_score >= 1 %}success
      {% elif article.vote_score <= -1 %}danger
      {% else %}secondary
      {% endif %}">{{ article.vote_score }}</span>
        {% if current_user.is_authenticated %}
      <form action="{{ url_for('article.vote_article', article_id=article.id) }}" method="post" class="d-inline">
        <input type="hidden" name="vote_type" value="downvote">
        <button class="btn btn-sm btn-outline-light
        {% if article.get_user_vote(current_user.id) == -1 %}active{% endif %}" type="submit">üëé</button>
      </form>
      {% endif %}
      <p class="text-secondary"><small>–ü—Ä–æ—Å–º–æ—Ç—Ä—ã: {{ article.view_count }}</small></p>
    </div>
  </div>

  <div class="card bg-secondary text-light mt-2 rounded-0">
    <div class="card-body">
      <h4 class="card-title">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h4>

      {% if current_user.is_authenticated %}
        <form action="{{ url_for('article.add_comment', article_id=article.id) }}" method="post" class="mt-4">
          <div class="form-group mb-2">
            <textarea name="content" class="form-control bg-dark text-light" rows="3" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required></textarea>
          </div>
          <button type="submit" class="btn btn-dark">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </form>
      {% else %}
        <p class="text-secondary mt-3">–ß—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, <a href="{{ url_for('auth.login') }}">–≤–æ–π–¥–∏—Ç–µ</a>.</p>
      {% endif %}

      {% if article.comments %}
        {% for comment in article.comments %}
          <div class="border-bottom py-2">
            <p class="mb-1"><strong>{{ comment.author.username }}</strong>
              <small class="text-secondary">({{ comment.created_date.strftime('%d.%m.%Y %H:%M') }})</small></p>
            <p class="mb-2">{{ comment.content }}</p>

            {% if current_user.is_authenticated %}
              <form action="{{ url_for('comments.vote_comment', comment_id=comment.id) }}" method="post" class="d-inline">
                <input type="hidden" name="vote_type" value="upvote">
                <button class="btn btn-sm btn-outline-light
                {% if comment.get_user_vote(current_user.id) == 1 %}active{% endif %}" type="submit">üëç</button>
              </form>
              {% endif %}
              <form action="{{ url_for('comments.vote_comment', comment_id=comment.id) }}" method="post" class="d-inline"></form>
              <span class="mx-2 text-{% if comment.vote_score >= 1 %}success
              {% elif comment.vote_score <= -1 %}danger
              {% else %}secondary
              {% endif %}">{{ comment.vote_score }}</span>
              {% if current_user.is_authenticated %}
              <form action="{{ url_for('comments.vote_comment', comment_id=comment.id) }}" method="post" class="d-inline">
                <input type="hidden" name="vote_type" value="downvote">
                <button class="btn btn-sm btn-outline-light
                {% if comment.get_user_vote(current_user.id) == -1 %}active{% endif %}" type="submit">üëé</button>
              </form>
            {% endif %}
            </div>
        {% endfor %}
      {% else %}
        <p class="text-muted">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
      {% endif %}
    </div>
  </div>
  <a href="{{ url_for('main.index') }}" class="btn btn-secondary text-light my-2">–ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
</div>
{% endblock %}
